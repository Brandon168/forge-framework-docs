<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Forge-framework-docs : Forge Framework Documentation" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Forge-framework-docs</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/kirkmadera/forge-framework-docs">View on GitHub</a>

          <h1 id="project_title">Forge-framework-docs</h1>
          <h2 id="project_tagline">Forge Framework Documentation</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/kirkmadera/forge-framework-docs/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/kirkmadera/forge-framework-docs/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>
<a name="forge-framework" class="anchor" href="#forge-framework"><span class="octicon octicon-link"></span></a>Forge Framework</h1>

<p>Forge Framework is an application level framework that runs on Zend Framework 2. The purpose of Forge Framework is to
provide prebuilt application components, fully functional out of the box, with flexible customization strategies that
offer full control to the user but do not break the upgrade path.</p>

<p>Zend Framework was chosen because of it's maturity, documentation, coding standards, loosely coupled libraries, and
event based MVC architecture. The event based architecture of ZF2 made it easy to introduce new Forge Framework
functionality in a non intrusive way.</p>

<p>A concerted effort was made to use Zend Framework 2 functionality as is where possible. All ZF2 documentation can be
relied upon to work with Forge Framework except where specifically noted. ZF2 community modules may be used directly
with Forge Framework. This is extremely useful for quickly testing ZF2 modules. However, to fully utilize Forge Framework's
view building capabilities, some customization is required.</p>

<p>Forge Framework also shares many similarities with Magento. For example, the composite view strategy based in layout
configuration files is based off of Magento's view strategy.</p>

<h2>
<a name="a-quick-walk-through" class="anchor" href="#a-quick-walk-through"><span class="octicon octicon-link"></span></a>A Quick Walk Through</h2>

<p>Forge Framework application flow is exactly that of ZF2 with a few additions. Below is a quick walk through of the
application flow.</p>

<p>Forge Framework implements the Front Controller pattern where all requests are routed through a single point. This is
an example of an index.php file which handles all incoming requests.</p>

<div class="highlight highlight-php"><pre><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">Zend\Config\Config</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Zend\Mvc\Application</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * This makes our life easier when dealing with paths. Everything is relative</span>
<span class="sd"> * to the application root now.</span>
<span class="sd"> */</span>
<span class="nb">chdir</span><span class="p">(</span><span class="nb">dirname</span><span class="p">(</span><span class="nx">__DIR__</span><span class="p">));</span>

<span class="c1">// Setup autoloading</span>
<span class="k">require</span> <span class="s1">'init_autoloader.php'</span><span class="p">;</span>

<span class="c1">// Configure the application</span>
<span class="nv">$config</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Config</span><span class="p">(</span><span class="k">require</span> <span class="s1">'config/application.global.php'</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">file_exists</span><span class="p">(</span><span class="s1">'config/application.local.php'</span><span class="p">))</span> <span class="p">{</span>
    <span class="nv">$config</span><span class="o">-&gt;</span><span class="na">merge</span><span class="p">(</span><span class="k">new</span> <span class="nx">Config</span><span class="p">(</span><span class="k">require</span> <span class="s1">'config/application.local.php'</span><span class="p">));</span>
<span class="p">}</span>

<span class="c1">// Initialize and run the application</span>
<span class="nx">Application</span><span class="o">::</span><span class="na">init</span><span class="p">(</span><span class="nv">$config</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">run</span><span class="p">();</span>
</pre></div>

<p>Lets break this file up into sections...</p>

<h3>
<a name="autoloading" class="anchor" href="#autoloading"><span class="octicon octicon-link"></span></a>Autoloading</h3>

<div class="highlight highlight-php"><pre><span class="o">&lt;?</span><span class="nx">php</span>
<span class="c1">// Setup autoloading</span>
<span class="k">require</span> <span class="s1">'init_autoloader.php'</span><span class="p">;</span>
</pre></div>

<p>Forge Framework initially sets up autoloading based on composer configs and default loading for ZF2 and Forge Framework.
Later in the application flow, modules add their autoload configuration as well.</p>

<h3>
<a name="application-configuration" class="anchor" href="#application-configuration"><span class="octicon octicon-link"></span></a>Application Configuration</h3>

<div class="highlight highlight-php"><pre><span class="o">&lt;?</span><span class="nx">php</span>
<span class="c1">// Configure the application!</span>
<span class="nv">$config</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Config</span><span class="p">(</span><span class="k">require</span> <span class="s1">'config/application.global.php'</span><span class="p">);</span>
</pre></div>

<p>This loads a global configuration file which is shared across all environments and is stored in version control. This
configuration is the minimal configuration needed to load the application. All other configuration is done from within
modules. This tells the application what modules to load in what order. It also tells the application where to find
other application config files, which directories to use for different things, whether to enable caching, etc.</p>

<div class="highlight highlight-php"><pre><span class="o">&lt;?</span><span class="nx">php</span>
<span class="c1">// application.global.php</span>
<span class="k">return</span> <span class="p">[</span>
    <span class="s1">'modules'</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">'ForgeApplication'</span><span class="p">,</span>
        <span class="s1">'ForgeAcl'</span><span class="p">,</span>
        <span class="s1">'ForgeUser'</span><span class="p">,</span>
        <span class="s1">'ForgeAdmin'</span><span class="p">,</span>
        <span class="s1">'ForgeDeveloperTools'</span><span class="p">,</span>
        <span class="s1">'Application'</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="s1">'module_listener_options'</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">'config_cache_enabled'</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">,</span>
        <span class="s1">'cache_dir'</span>            <span class="o">=&gt;</span> <span class="s1">'data/cache'</span><span class="p">,</span>
        <span class="s1">'config_glob_paths'</span>    <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">'config/autoload/{,*.}local.php'</span><span class="p">,</span>
            <span class="s1">'config/autoload/{,*.}global.php'</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="s1">'module_paths'</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">'module/core'</span><span class="p">,</span>
            <span class="s1">'module/thirdparty'</span><span class="p">,</span>
            <span class="s1">'module/local'</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">],</span>
<span class="p">];</span>
</pre></div>

<p>An environment specific file is then merged on top to allow for settings like enabling or disabling caching or enabling
css/js merging and minification.</p>

<div class="highlight highlight-php"><pre><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">file_exists</span><span class="p">(</span><span class="s1">'config/application.local.php'</span><span class="p">))</span> <span class="p">{</span>
    <span class="nv">$config</span><span class="o">-&gt;</span><span class="na">merge</span><span class="p">(</span><span class="k">new</span> <span class="nx">Config</span><span class="p">(</span><span class="k">require</span> <span class="s1">'config/application.local.php'</span><span class="p">));</span>
<span class="p">}</span>
</pre></div>

<div class="highlight highlight-php"><pre><span class="o">&lt;?</span><span class="nx">php</span>
<span class="c1">// application.local.php</span>
<span class="k">return</span> <span class="p">[</span>
    <span class="s1">'module_listener_options'</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">'config_cache_enabled'</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">];</span>
</pre></div>

<p>All configuration merging is done with array_replace_recursive logic with one exception. If all indexes of an array
are numeric, the second array is merged on top of the first instead like array_merge. This is done using ZF2's built in
Config class.</p>

<h3>
<a name="initialization" class="anchor" href="#initialization"><span class="octicon octicon-link"></span></a>Initialization</h3>

<p>The index file uses Application::init() to initialize the application. This is only a default configuration method for
Forge Framework. The tasks within Application::init() could be placed directly into index.php as well if customization
is needed.</p>

<div class="highlight highlight-php"><pre><span class="o">&lt;?</span><span class="nx">php</span>
<span class="c1">// Initialize and run the application</span>
<span class="nx">Application</span><span class="o">::</span><span class="na">init</span><span class="p">(</span><span class="nv">$config</span><span class="p">);</span>
</pre></div>

<div class="highlight highlight-php"><pre><span class="o">&lt;?</span><span class="nx">php</span>
<span class="c1">// Zend\Mvc\Application</span>
<span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">init</span><span class="p">(</span><span class="nv">$configuration</span> <span class="o">=</span> <span class="k">array</span><span class="p">())</span>
<span class="p">{</span>
    <span class="nv">$smConfig</span> <span class="o">=</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$configuration</span><span class="p">[</span><span class="s1">'service_manager'</span><span class="p">])</span> <span class="o">?</span> <span class="nv">$configuration</span><span class="p">[</span><span class="s1">'service_manager'</span><span class="p">]</span> <span class="o">:</span> <span class="k">array</span><span class="p">();</span>
    <span class="nv">$serviceManager</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ServiceManager</span><span class="p">(</span><span class="k">new</span> <span class="nx">Service\ServiceManagerConfig</span><span class="p">(</span><span class="nv">$smConfig</span><span class="p">));</span>
    <span class="nv">$serviceManager</span><span class="o">-&gt;</span><span class="na">setService</span><span class="p">(</span><span class="s1">'ApplicationConfig'</span><span class="p">,</span> <span class="nv">$configuration</span><span class="p">);</span>
    <span class="nv">$serviceManager</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">'ModuleManager'</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">loadModules</span><span class="p">();</span>

    <span class="nv">$listenersFromAppConfig</span>     <span class="o">=</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$configuration</span><span class="p">[</span><span class="s1">'listeners'</span><span class="p">])</span> <span class="o">?</span> <span class="nv">$configuration</span><span class="p">[</span><span class="s1">'listeners'</span><span class="p">]</span> <span class="o">:</span> <span class="k">array</span><span class="p">();</span>
    <span class="nv">$config</span>                     <span class="o">=</span> <span class="nv">$serviceManager</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">'Config'</span><span class="p">);</span>
    <span class="nv">$listenersFromConfigService</span> <span class="o">=</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'listeners'</span><span class="p">])</span> <span class="o">?</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'listeners'</span><span class="p">]</span> <span class="o">:</span> <span class="k">array</span><span class="p">();</span>

    <span class="nv">$listeners</span> <span class="o">=</span> <span class="nb">array_unique</span><span class="p">(</span><span class="nb">array_merge</span><span class="p">(</span><span class="nv">$listenersFromConfigService</span><span class="p">,</span> <span class="nv">$listenersFromAppConfig</span><span class="p">));</span>

    <span class="k">return</span> <span class="nv">$serviceManager</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">'Application'</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">bootstrap</span><span class="p">(</span><span class="nv">$listeners</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>This sets up the service manager, loads all modules, then bootstraps the application.</p>

<h4>
<a name="the-service-manager" class="anchor" href="#the-service-manager"><span class="octicon octicon-link"></span></a>The Service Manager</h4>

<p>The service manager is a service locator pattern. It also doubles as a dependency injection container. Through
configuration, all classes and instances of classes can be substituted for others, initialized, run through factory
constructors, and aliased. By default, the same instance of a class is returned every time it is requested from the
service manager. A new object can be requested on demand. This effectively can be used as a singleton pattern as well.</p>

<p>ZF2 previous to initial release had a dedicated dependency injection implementation. This was deemed overcomplicated for
the average user to use or care about, but the service manager worked well enough and had a simple enough interface that
it became a direct replacement. The service manager still falls back to the original dependency injection
implementation when no service configuration can be found. For more information on the service manager, read the
<a href="http://framework.zend.com/manual/2.3/en/modules/zend.service-manager.quick-start.html">ZF2 documentation</a>.</p>

<h4>
<a name="module-loading" class="anchor" href="#module-loading"><span class="octicon octicon-link"></span></a>Module Loading</h4>

<p>Modules are loaded in the order specified in the application configuration. This is event based.</p>

<p>These are the relevant events:</p>

<ul>
<li>ModuleEvent::EVENT_LOAD_MODULES</li>
<li>ModuleEvent::EVENT_LOAD_MODULE</li>
<li>ModuleEvent::EVENT_LOAD_MODULES_POST</li>
</ul><p>The following tasks are performed for each module, via events:</p>

<p>(Not entirely sure on the order. Need to review)</p>

<ol>
<li>Load module config</li>
<li>Set up module autoloaders</li>
<li>Check module dependencies</li>
<li>Run init() method on module</li>
<li>Add service manager settings from module to main service manager</li>
<li>Add module, itself, to the service manager</li>
<li>Attach the onBootstrap() method of each module to the bootstrap event which will be run once all modules are loaded</li>
</ol><h4>
<a name="bootstrapping-the-application" class="anchor" href="#bootstrapping-the-application"><span class="octicon octicon-link"></span></a>Bootstrapping the Application</h4>

<p>The application is bootstrapped once all modules are loaded and the configuration is complete. Routers are created based
on the router map from the config.</p>

<div class="highlight highlight-php"><pre><span class="o">&lt;?</span><span class="nx">php</span>
<span class="c1">// Zend\Application\Application</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">bootstrap</span><span class="p">(</span><span class="k">array</span> <span class="nv">$listeners</span> <span class="o">=</span> <span class="k">array</span><span class="p">())</span>
<span class="p">{</span>
    <span class="nv">$serviceManager</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">serviceManager</span><span class="p">;</span>
    <span class="nv">$events</span>         <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">events</span><span class="p">;</span>

    <span class="nv">$listeners</span> <span class="o">=</span> <span class="nb">array_unique</span><span class="p">(</span><span class="nb">array_merge</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">defaultListeners</span><span class="p">,</span> <span class="nv">$listeners</span><span class="p">));</span>

    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$listeners</span> <span class="k">as</span> <span class="nv">$listener</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$events</span><span class="o">-&gt;</span><span class="na">attach</span><span class="p">(</span><span class="nv">$serviceManager</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="nv">$listener</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="c1">// Setup MVC Event</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">event</span> <span class="o">=</span> <span class="nv">$event</span>  <span class="o">=</span> <span class="k">new</span> <span class="nx">MvcEvent</span><span class="p">();</span>
    <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">setTarget</span><span class="p">(</span><span class="nv">$this</span><span class="p">);</span>
    <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">setApplication</span><span class="p">(</span><span class="nv">$this</span><span class="p">)</span>
          <span class="o">-&gt;</span><span class="na">setRequest</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">)</span>
          <span class="o">-&gt;</span><span class="na">setResponse</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">response</span><span class="p">)</span>
          <span class="o">-&gt;</span><span class="na">setRouter</span><span class="p">(</span><span class="nv">$serviceManager</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">'Router'</span><span class="p">));</span>

    <span class="c1">// Trigger bootstrap events</span>
    <span class="nv">$events</span><span class="o">-&gt;</span><span class="na">trigger</span><span class="p">(</span><span class="nx">MvcEvent</span><span class="o">::</span><span class="na">EVENT_BOOTSTRAP</span><span class="p">,</span> <span class="nv">$event</span><span class="p">);</span>
    <span class="k">return</span> <span class="nv">$this</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>This enables the default route, dispatch, and view listeners, sets up the MvcEvent, and triggers the bootstrap event.
Modules may implement an "onBootstrap" method. This method is run after the rest of the application has been initialized.
This is the point where modules have all access to everything they may need within the application. Most module
initialization should occur here.</p>

<h3>
<a name="running-the-application" class="anchor" href="#running-the-application"><span class="octicon octicon-link"></span></a>Running the Application</h3>

<div class="highlight highlight-php"><pre><span class="o">&lt;?</span><span class="nx">php</span>
<span class="c1">// Zend\Application\Application</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">run</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nv">$events</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">events</span><span class="p">;</span>
    <span class="nv">$event</span>  <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">event</span><span class="p">;</span>

    <span class="c1">// Define callback used to determine whether or not to short-circuit</span>
    <span class="nv">$shortCircuit</span> <span class="o">=</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$r</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$event</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$r</span> <span class="nx">instanceof</span> <span class="nx">ResponseInterface</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$event</span><span class="o">-&gt;</span><span class="na">getError</span><span class="p">())</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">};</span>

    <span class="c1">// Trigger route event</span>
    <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$events</span><span class="o">-&gt;</span><span class="na">trigger</span><span class="p">(</span><span class="nx">MvcEvent</span><span class="o">::</span><span class="na">EVENT_ROUTE</span><span class="p">,</span> <span class="nv">$event</span><span class="p">,</span> <span class="nv">$shortCircuit</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$result</span><span class="o">-&gt;</span><span class="na">stopped</span><span class="p">())</span> <span class="p">{</span>
        <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$result</span><span class="o">-&gt;</span><span class="na">last</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$response</span> <span class="nx">instanceof</span> <span class="nx">ResponseInterface</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">setTarget</span><span class="p">(</span><span class="nv">$this</span><span class="p">);</span>
            <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">setResponse</span><span class="p">(</span><span class="nv">$response</span><span class="p">);</span>
            <span class="nv">$events</span><span class="o">-&gt;</span><span class="na">trigger</span><span class="p">(</span><span class="nx">MvcEvent</span><span class="o">::</span><span class="na">EVENT_FINISH</span><span class="p">,</span> <span class="nv">$event</span><span class="p">);</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">response</span> <span class="o">=</span> <span class="nv">$response</span><span class="p">;</span>
            <span class="k">return</span> <span class="nv">$this</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$event</span><span class="o">-&gt;</span><span class="na">getError</span><span class="p">())</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">completeRequest</span><span class="p">(</span><span class="nv">$event</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$event</span><span class="o">-&gt;</span><span class="na">getError</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">completeRequest</span><span class="p">(</span><span class="nv">$event</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Trigger dispatch event</span>
    <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$events</span><span class="o">-&gt;</span><span class="na">trigger</span><span class="p">(</span><span class="nx">MvcEvent</span><span class="o">::</span><span class="na">EVENT_DISPATCH</span><span class="p">,</span> <span class="nv">$event</span><span class="p">,</span> <span class="nv">$shortCircuit</span><span class="p">);</span>

    <span class="c1">// Complete response</span>
    <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$result</span><span class="o">-&gt;</span><span class="na">last</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$response</span> <span class="nx">instanceof</span> <span class="nx">ResponseInterface</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">setTarget</span><span class="p">(</span><span class="nv">$this</span><span class="p">);</span>
        <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">setResponse</span><span class="p">(</span><span class="nv">$response</span><span class="p">);</span>
        <span class="nv">$events</span><span class="o">-&gt;</span><span class="na">trigger</span><span class="p">(</span><span class="nx">MvcEvent</span><span class="o">::</span><span class="na">EVENT_FINISH</span><span class="p">,</span> <span class="nv">$event</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">response</span> <span class="o">=</span> <span class="nv">$response</span><span class="p">;</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">response</span><span class="p">;</span>
    <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">setResponse</span><span class="p">(</span><span class="nv">$response</span><span class="p">);</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">completeRequest</span><span class="p">(</span><span class="nv">$event</span><span class="p">);</span>

    <span class="k">return</span> <span class="nv">$this</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<div class="highlight highlight-php"><pre><span class="o">&lt;?</span><span class="nx">php</span>
<span class="c1">// Zend\Application\Application</span>
<span class="k">protected</span> <span class="k">function</span> <span class="nf">completeRequest</span><span class="p">(</span><span class="nx">MvcEvent</span> <span class="nv">$event</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nv">$events</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">events</span><span class="p">;</span>
    <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">setTarget</span><span class="p">(</span><span class="nv">$this</span><span class="p">);</span>
    <span class="nv">$events</span><span class="o">-&gt;</span><span class="na">trigger</span><span class="p">(</span><span class="nx">MvcEvent</span><span class="o">::</span><span class="na">EVENT_RENDER</span><span class="p">,</span> <span class="nv">$event</span><span class="p">);</span>
    <span class="nv">$events</span><span class="o">-&gt;</span><span class="na">trigger</span><span class="p">(</span><span class="nx">MvcEvent</span><span class="o">::</span><span class="na">EVENT_FINISH</span><span class="p">,</span> <span class="nv">$event</span><span class="p">);</span>
    <span class="k">return</span> <span class="nv">$this</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>The application is now set up and the request can be handled.</p>

<p>The first step is to attempt to route the request. The request URI is mapped to a route defined within the configuration.
If the URI cannot be mapped, a 404 page is served. The request may also directly lead to a redirect. If so, the redirect
is issued immediately. If a controller action can be determined from the request, the application dispatches to the
controller. If the controller action does not exist, a 404 page is served. If it does exist, the action is executed.</p>

<p>The controller action may return a number of different response types. Depending on the response returned, a specific
listener will pick the response up and process it.</p>

<p>These are the current possible return types and their behaviors:</p>

<ul>
<li>null - A simple view object is constructed using the module, controller, and action name to grab a template</li>
<li>array() - The same view is constructed as null, except that the data provided in the array is made available as variables
in the view script.</li>
<li>JsonViewModel - Will be rendered directly as JSON</li>
<li>ViewModel - No post processing is done. The view model is rendered as is</li>
<li>CompositeViewModel - The view model is rendered via Forge Framework's composite view strategy</li>
<li>Response - If a direct response object is returned, it will be rendered directly as is without any rendering strategy</li>
</ul><p>These views are rendered by listeners of the MvcEvent::EVENT_RENDER event. New listeners can be attached to watch for
different response types. For example, if xml output needed to be rendered, a listener could be registered to watch for
a return type of SimpleXml.</p>

<p>Finally, the MvcEvent::EVENT_FINISH event fires. This handles the actual output to the browser. Headers are send first,
then, the output is sent.</p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Forge-framework-docs maintained by <a href="https://github.com/kirkmadera">kirkmadera</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-33125875-11");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>


  </body>
</html>
